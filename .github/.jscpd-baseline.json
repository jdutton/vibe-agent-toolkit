{
  "duplicates": [
    {
      "format": "typescript",
      "lines": 47,
      "fragment": "function createMockAgent() {\n  return {\n    name: 'breed-advisor',\n    manifest: {\n      name: 'breed-advisor',\n      archetype: 'two-phase-conversational-assistant',\n      description: 'Test agent',\n      version: '1.0.0',\n    },\n    execute: vi.fn().mockImplementation((input: { message: string; sessionState?: { profile?: Record<string, unknown> } }, context: { addToHistory: (role: string, content: string) => void }) => {\n      const { message, sessionState } = input;\n      const currentState = sessionState?.profile ?? {};\n\n      // Add user message to history\n      context.addToHistory('user', message);\n\n      // Extract info from user message (simple pattern matching)\n      const newState = { ...currentState };\n\n      if (/apartment|small.*apartment/i.test(message)) {\n        newState.livingSpace = 'apartment';\n      }\n      if (/jazz/i.test(message)) {\n        newState.musicPreference = 'jazz';\n      }\n      if (/classical/i.test(message)) {\n        newState.musicPreference = 'classical';\n      }\n      if (/calm|low.energy|lazy/i.test(message)) {\n        newState.activityLevel = 'couch-companion';\n      }\n\n      const reply = 'Mocked agent response';\n\n      // Add assistant response to history\n      context.addToHistory('assistant', reply);\n\n      return Promise.resolve({\n        reply,\n        sessionState: newState,\n        result: { status: 'in-progress' },\n      });\n    }),\n  };\n}\n\n// Mock OpenAI SDK",
      "tokens": 0,
      "firstFile": {
        "name": "packages/vat-example-cat-agents/test/conversational-adapters/openai-adapter.test.ts",
        "start": 15,
        "end": 61,
        "startLoc": {
          "line": 15,
          "column": 1,
          "position": 69
        },
        "endLoc": {
          "line": 61,
          "column": 19,
          "position": 465
        }
      },
      "secondFile": {
        "name": "packages/vat-example-cat-agents/test/conversational-adapters/vercel-ai-sdk-adapter.test.ts",
        "start": 17,
        "end": 63,
        "startLoc": {
          "line": 17,
          "column": 1,
          "position": 70
        },
        "endLoc": {
          "line": 63,
          "column": 22,
          "position": 466
        }
      }
    },
    {
      "format": "typescript",
      "lines": 40,
      "fragment": ",\n    },\n    execute: vi.fn().mockImplementation((input: { message: string; sessionState?: { profile?: Record<string, unknown> } }, context: { addToHistory: (role: string, content: string) => void }) => {\n      const { message, sessionState } = input;\n      const currentState = sessionState?.profile ?? {};\n\n      // Add user message to history\n      context.addToHistory('user', message);\n\n      // Extract info from user message (simple pattern matching)\n      const newState = { ...currentState };\n\n      if (/apartment|small.*apartment/i.test(message)) {\n        newState.livingSpace = 'apartment';\n      }\n      if (/jazz/i.test(message)) {\n        newState.musicPreference = 'jazz';\n      }\n      if (/classical/i.test(message)) {\n        newState.musicPreference = 'classical';\n      }\n      if (/calm|low.energy|lazy/i.test(message)) {\n        newState.activityLevel = 'couch-companion';\n      }\n\n      const reply = 'Mocked agent response';\n\n      // Add assistant response to history\n      context.addToHistory('assistant', reply);\n\n      return Promise.resolve({\n        reply,\n        sessionState: newState,\n        result: { status: 'in-progress' },\n      });\n    }),\n  };\n}\n\n// Mock LangChain",
      "tokens": 0,
      "firstFile": {
        "name": "packages/vat-example-cat-agents/test/conversational-adapters/langchain-adapter.test.ts",
        "start": 25,
        "end": 64,
        "startLoc": {
          "line": 25,
          "column": 2,
          "position": 138
        },
        "endLoc": {
          "line": 64,
          "column": 18,
          "position": 482
        }
      },
      "secondFile": {
        "name": "packages/vat-example-cat-agents/test/conversational-adapters/vercel-ai-sdk-adapter.test.ts",
        "start": 24,
        "end": 63,
        "startLoc": {
          "line": 24,
          "column": 8,
          "position": 122
        },
        "endLoc": {
          "line": 63,
          "column": 22,
          "position": 466
        }
      }
    },
    {
      "format": "typescript",
      "lines": 53,
      "fragment": ";\n\nimport { testConversationalAdapterContract } from './shared-contract-tests.js';\nimport { testAdapterCreation, testMissingAPIKey } from './test-helpers.js';\n\n// Factory function for creating mock agent (must be defined before vi.mock() for hoisting)\nfunction createMockAgent() {\n  return {\n    name: 'breed-advisor',\n    manifest: {\n      name: 'breed-advisor',\n      archetype: 'two-phase-conversational-assistant',\n      description: 'Test agent',\n      version: '1.0.0',\n    },\n    execute: vi.fn().mockImplementation((input: { message: string; sessionState?: { profile?: Record<string, unknown> } }, context: { addToHistory: (role: string, content: string) => void }) => {\n      const { message, sessionState } = input;\n      const currentState = sessionState?.profile ?? {};\n\n      // Add user message to history\n      context.addToHistory('user', message);\n\n      // Extract info from user message (simple pattern matching)\n      const newState = { ...currentState };\n\n      if (/apartment|small.*apartment/i.test(message)) {\n        newState.livingSpace = 'apartment';\n      }\n      if (/jazz/i.test(message)) {\n        newState.musicPreference = 'jazz';\n      }\n      if (/classical/i.test(message)) {\n        newState.musicPreference = 'classical';\n      }\n      if (/calm|low.energy|lazy/i.test(message)) {\n        newState.activityLevel = 'couch-companion';\n      }\n\n      const reply = 'Mocked agent response';\n\n      // Add assistant response to history\n      context.addToHistory('assistant', reply);\n\n      return Promise.resolve({\n        reply,\n        sessionState: newState,\n        result: { status: 'in-progress' },\n      });\n    }),\n  };\n}\n\n// Mock Anthropic SDK",
      "tokens": 0,
      "firstFile": {
        "name": "packages/vat-example-cat-agents/test/conversational-adapters/claude-agent-sdk-adapter.test.ts",
        "start": 9,
        "end": 61,
        "startLoc": {
          "line": 9,
          "column": 69,
          "position": 37
        },
        "endLoc": {
          "line": 61,
          "column": 22,
          "position": 468
        }
      },
      "secondFile": {
        "name": "packages/vat-example-cat-agents/test/conversational-adapters/openai-adapter.test.ts",
        "start": 9,
        "end": 63,
        "startLoc": {
          "line": 9,
          "column": 59,
          "position": 34
        },
        "endLoc": {
          "line": 63,
          "column": 22,
          "position": 466
        }
      }
    }
  ]
}